<?xml version="1.0" encoding="UTF-8"?>
<!--
    This file is part of InfoGrid(tm). You may not use this file except in
    compliance with the InfoGrid license. The InfoGrid license and important
    disclaimers are contained in the file LICENSE.InfoGrid.txt that you should
    have received with InfoGrid. If you have not received LICENSE.InfoGrid.txt
    or you do not consent to all aspects of the license and the disclaimers,
    no license is granted; do not use this file.
 
    For more information about InfoGrid go to http://infogrid.org/

    Copyright 1998-2008 by R-Objects Inc. dba NetMesh Inc., Johannes Ernst
    All rights reserved.
-->

<!DOCTYPE model PUBLIC '-//InfoGrid.org//InfoGrid Model//EN' 'http://infogrid.org/dtds/model.dtd'>
<model>
    <subjectarea ID="org.infogrid.lid.model.lid">
        <name>org.infogrid.lid.model.lid</name>
        <username>LID Subject Area</username>
        <userdescription>The concepts defined by LID that aren't defined anywhere else.</userdescription>

        <dependson>
            <subjectareareference>
                <name>org.infogrid.lid.model.yadis</name>
            </subjectareareference>
        </dependson>

        <entitytype ID="org.infogrid.lid.model.lid#IdentityProvider">
            <name>IdentityProvider</name>
            <username>Identity Provider</username>
            <userdescription>A MeshObject that is an Identity Provider. It generally offers one or more
Authentication Services.</userdescription>
            <supertype>org.infogrid.lid.model.yadis#Site</supertype>

            <propertytype ID="org.infogrid.lid.model.lid#IdentityProvider/RequiresUserSpecificSecret">
                <name>RequiresUserSpecificSecret</name>
                <username>RequiresUserSpecificSecret</username>
                <userdescription>True if this Identity Provider requires a user-specific secret to authenticate users.
This could be a password, or a hardware token, but not a client certificate.</userdescription>
                <datatype>
                    <BooleanDataType/>
                </datatype>
                <isoptional/>
            </propertytype>

            <propertytype ID="org.infogrid.lid.model.lid#IdentityProvider/RequiresHardwareToken">
                <name>RequiresHardwareToken</name>
                <username>RequiresHardwareToken</username>
                <userdescription>True if this Identity Provider requires a hardware token to authenticate users.</userdescription>
                <datatype>
                    <BooleanDataType/>
                </datatype>
                <isoptional/>
            </propertytype>

            <propertytype ID="org.infogrid.lid.model.lid#IdentityProvider/RequiresEncryptedCommunications">
                <name>RequiresEncryptedCommunications</name>
                <username>RequiresEncryptedCommunications</username>
                <userdescription>True if this Identity Provider requires that all secrets are exchanged in encrypted form
                     between itself and its users.</userdescription>
                <datatype>
                    <BooleanDataType/>
                </datatype>
                <isoptional/>
            </propertytype>
         </entitytype>

        <entitytype ID="org.infogrid.lid.model.lid#RelyingParty">
            <name>RelyingParty</name>
            <username>Relying Party</username>
            <userdescription>A MeshObject that can accept externally provided identities. It generally provides one or
more RelyingPartyServices.</userdescription>
            <supertype>org.infogrid.lid.model.yadis#Site</supertype>
            
            <propertytype ID="org.infogrid.lid.model.lid#RelyingParty/RequiresUserSpecificSecret">
                <name>RequiresUserSpecificSecret</name>
                <username>RequiresUserSpecificSecret</username>
                <userdescription>True if this Relying Party only trusts Identity Providers that require a
user-specific secret to authenticate users.
This could be a password, or a hardware token, but not a client certificate.</userdescription>
                <datatype>
                    <BooleanDataType/>
                </datatype>
                <isoptional/>
            </propertytype>

            <propertytype ID="org.infogrid.lid.model.lid#RelyingParty/RequiresHardwareToken">
                <name>RequiresHardwareToken</name>
                <username>RequiresHardwareToken</username>
                <userdescription>True if this Relying Party only trusts Identity Providers that require
a hardware token to authenticate users.</userdescription>
                <datatype>
                    <BooleanDataType/>
                </datatype>
                <isoptional/>
            </propertytype>

            <propertytype ID="org.infogrid.lid.model.lid#RelyingParty/RequiresEncryptedCommunications">
                <name>RequiresEncryptedCommunications</name>
                <username>RequiresEncryptedCommunications</username>
                <userdescription>True if this Relying Party only trusts Identity Providers that require that
all secrets are exchanged in encrypted form.</userdescription>
                <datatype>
                    <BooleanDataType/>
                </datatype>
                <isoptional/>
            </propertytype>
        </entitytype>

        <entitytype ID="org.infogrid.lid.model.lid#Principal">
            <name>Principal</name>
            <userdescription>A MeshObject that represents an pricipal, such as a user. It generally makes use of
one or more Yadis Services.</userdescription>
            <supertype>org.infogrid.lid.model.yadis#Site</supertype>
        </entitytype>
        
        <entitytype ID="org.infogrid.lid.model.lid#AuthenticationService">
            <name>AuthenticationService</name>
            <userdescription>A Yadis Service that is able to authenticate a principal. More specific subclasses
are provided for specific authentication protocols.</userdescription>
            <supertype>org.infogrid.lid.model.yadis#Service</supertype>
            <isabstract/>
        </entitytype>

        <entitytype ID="org.infogrid.lid.model.lid#WebAuthenticationService">
            <name>WebAuthenticationService</name>
            <userdescription>An AuthenticationService that uses a standard web browser as the client device,
and thus implements the redirect dance. More specific subclasses
are provided for specific authentication protocols.</userdescription>
            <supertype>org.infogrid.lid.model.lid#AuthenticationService</supertype>
            <isabstract/>
            <declaresMethod>
    public abstract String determineRedirectUrl(
            MeshObject                        principal,
            String                            here,
            String                            trustRoot,
            org.infogrid.util.context.Context context )
        throws
            org.infogrid.mesh.NotPermittedException,
            org.infogrid.util.FactoryException;
            </declaresMethod>
        </entitytype>

        <entitytype ID="http://lid.netmesh.org/sso">
            <name>LidGpgSso</name>
            <username>LID's GPG-based Authentication Service</username>
            <userdescription>This represents a LID GPG-based Authentication Service in any version.</userdescription>
            <supertype>org.infogrid.lid.model.lid#WebAuthenticationService</supertype>
            <isabstract/>
        </entitytype>        

        <entitytype ID="http://lid.netmesh.org/sso/2.0">
            <name>LidGpgSso2</name>
            <username>LID's GPG-based Authentication Service (version 2)</username>
            <userdescription>An Authentication Service based on the LID GPG SSO service, version 2.</userdescription>
            <supertype>http://lid.netmesh.org/sso</supertype>
            <implementsMethod><![CDATA[
    public String determineRedirectUrl(
            MeshObject                        principal,
            String                            here,
            String                            trustRoot,
            org.infogrid.util.context.Context context )
    {
        org.infogrid.mesh.set.MeshObjectSet endpoints = this.traverse(
                org.infogrid.lid.model.yadis.YadisSubjectArea.SERVICE_ISPROVIDEDATENDPOINT_SITE.getSource() );
        if( endpoints.isEmpty() ) {
            throw new IllegalArgumentException( "no Endpoint found" );
        }
        // FIXME, should use more complex selection algorithm
        MeshObject selectedEndpoint = endpoints.getMeshObjects()[0];
        String     endpointUrl      = selectedEndpoint.getIdentifier().toExternalForm();

        String ret = endpointUrl;

        String target = org.infogrid.util.http.HTTP.appendArgumentToUrl( here, "lid-credtype=gpg%20--clearsign" );

        ret = org.infogrid.util.http.HTTP.appendArgumentToUrl( ret, "lid-action=sso-approve" );
        ret = org.infogrid.util.http.HTTP.appendArgumentToUrl( ret, "lid-target=" + org.infogrid.util.http.HTTP.encodeToValidUrlArgument( target.toString() ));

        return ret.toString();
    }
          ]]></implementsMethod>
        </entitytype>

        <entitytype ID="http://lid.netmesh.org/minimum-lid/2.0">
            <name>MinimumLid2</name>
            <username>Minimum LID (version 2)</username>
            <supertype>org.infogrid.lid.model.yadis#Service</supertype>
        </entitytype>

        <entitytype ID="org.infogrid.lid.model.lid#RelyingPartyService">
            <name>RelyingPartyService</name>
            <userdescription>A Yadis Service that is able to accept authentication assertions. More specific subclasses
are provided for specific protocols.</userdescription>
            <supertype>org.infogrid.lid.model.yadis#Service</supertype>
        </entitytype>

        <entitytype ID="http://lid.netmesh.org/relying-party">
            <name>LidGpgRelyingParty</name>
            <username>LID's GPG-based Relying Party Service</username>
            <userdescription>This represents a LID GPG-based Relying Party Service in any version.</userdescription>
            <supertype>org.infogrid.lid.model.lid#RelyingPartyService</supertype>
            <isabstract/>
        </entitytype>

        <entitytype ID="http://lid.netmesh.org/relying-party/2.0">
            <name>LidGpgRelyingParty2</name>
            <username>LID's GPG-based Relying Party Service (version 2)</username>
            <userdescription>A LID GPG-based Relying Party Service based on the LID GPG SSO service, version 2.</userdescription>
            <supertype>http://lid.netmesh.org/relying-party</supertype>
        </entitytype>

        <entitytype ID="org.infogrid.lid.model.lid#HardwareTokenRelyingParty">
            <name>HardwareTokenRelyingParty</name>
            <username>Hardware token-based Relying Party</username>
            <userdescription>This represents a Relying Party that accepts hardware tokens.</userdescription>
            <supertype>org.infogrid.lid.model.lid#RelyingPartyService</supertype>
        </entitytype>

        <entitytype ID="org.infogrid.lid.model.lid#SimpleUserPasswordRelyingParty">
            <name>SimpleUserPasswordRelyingParty</name>
            <username>Username/password-based Relying Party</username>
            <userdescription>This represents a Relying Party that accepts usernames and passwords.</userdescription>
            <supertype>org.infogrid.lid.model.lid#RelyingPartyService</supertype>
        </entitytype>

        <entitytype ID="http://lid.netmesh.org/traversal/2.0">
            <name>TraversalService2</name>
            <userdescription>A Yadis Service to traverse from one object to zero, one or more others.</userdescription>
            <supertype>org.infogrid.lid.model.yadis#Service</supertype>
        </entitytype>

        <entitytype ID="http://lid.netmesh.org/format-negotiation/2.0">
            <name>FormatNegotiation</name>
            <userdescription>A Yadis Service to negotiate the format of responses.</userdescription>
            <supertype>org.infogrid.lid.model.yadis#Service</supertype>
        </entitytype>

        <entitytype ID="http://lid.netmesh.org/post/sender/2.0">
            <name>PostSender</name>
            <userdescription>A Yadis Service to send messages from one place to another.</userdescription>
            <supertype>org.infogrid.lid.model.yadis#Service</supertype>
        </entitytype>

        <entitytype ID="http://lid.netmesh.org/post/receiver/2.0">
            <name>PostReceiver</name>
            <userdescription>A Yadis Service to receive messages from another place.</userdescription>
            <supertype>org.infogrid.lid.model.yadis#Service</supertype>
        </entitytype>
    </subjectarea>
</model>
